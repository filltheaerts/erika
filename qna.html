<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERIKA — Q&A</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Noto+Sans+KR:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- NAV -->
  <nav class="nav" id="nav">
    <div class="container">
      <a href="index.html" class="nav-logo">ERIKA<span>.</span></a>
      <div class="nav-links" id="navLinks">
        <a href="index.html" data-i18n="nav.home">Home</a>
        <a href="project.html" data-i18n="nav.project">Project</a>
        <a href="qna.html" class="active" data-i18n="nav.qna">Q&A</a>
        <a href="board.html" data-i18n="nav.board">Board</a>
        <div class="lang-toggle">
          <button data-lang="ko">KR</button>
          <button class="active" data-lang="en">EN</button>
        </div>
      </div>
      <div class="nav-hamburger" id="hamburger">
        <span></span><span></span><span></span>
      </div>
    </div>
  </nav>

  <!-- PAGE HEADER -->
  <div class="page-header">
    <div class="container">
      <p class="section-label" data-i18n="qna.label">Q&A</p>
      <h1 data-i18n="qna.title">자주 묻는 질문</h1>
      <p data-i18n="qna.desc">가장 많이 묻는 질문들을 모았습니다. 원하는 답변이 없다면 게시판에서 새 질문을 남겨주세요.</p>
    </div>
  </div>

  <!-- Q&A CONTENT -->
  <section class="section" style="background:var(--white)">
    <div class="container">

      <!-- Search -->
      <div class="qna-search">
        <span class="search-icon">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="7"/><line x1="15" y1="15" x2="12" y2="12"/></svg>
        </span>
        <input type="text" id="qnaSearch" placeholder="질문 검색..." data-i18n-placeholder="qna.search">
      </div>

      <!-- Category Filter -->
      <div class="qna-categories">
        <button class="qna-cat-btn active" data-cat="all" data-i18n="qna.cat.all">전체</button>
        <button class="qna-cat-btn" data-cat="RH">RH</button>
        <button class="qna-cat-btn" data-cat="VV">VV</button>
        <button class="qna-cat-btn" data-cat="commercial">Commercial</button>
        <button class="qna-cat-btn" data-cat="user acquisition">User Acquisition</button>
      </div>

      <!-- Accordion Q&A -->
      <div class="accordion" id="qnaAccordion">
        <!-- Items are dynamically loaded from board data -->
      </div>

      <div class="empty-state hidden" id="qnaEmpty">
        <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2"><circle cx="32" cy="32" r="28"/><path d="M24 24c0-4.4 3.6-8 8-8s8 3.6 8 8-3.6 8-8 8v4"/><circle cx="32" cy="48" r="2" fill="currentColor"/></svg>
        <p data-i18n="qna.empty">해당하는 질문이 없습니다.</p>
      </div>

    </div>
  </section>

  <!-- CTA -->
  <section class="section">
    <div class="container">
      <div class="cta-banner fade-in">
        <h2 data-i18n="qna.cta.title">원하는 답을 못 찾으셨나요?</h2>
        <p data-i18n="qna.cta.desc">게시판에서 직접 질문을 남겨주시면 빠르게 답변 드리겠습니다.</p>
        <a href="board.html" class="btn" data-i18n="qna.cta.btn">질문하러 가기</a>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 ERIKA. All rights reserved.</p>
      <div class="footer-links">
        <a href="index.html" data-i18n="nav.home">Home</a>
        <a href="project.html" data-i18n="nav.project">Project</a>
        <a href="qna.html" data-i18n="nav.qna">Q&A</a>
        <a href="board.html" data-i18n="nav.board">Board</a>
      </div>
    </div>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js?v=3"></script>
  <script src="js/main.js?v=3"></script>
  <script src="js/board.js?v=3"></script>
  <script src="js/cms.js?v=3"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await CMS.init();
      CMS.renderCategoryOptions();

      const accordion = document.getElementById('qnaAccordion');
      const emptyEl = document.getElementById('qnaEmpty');
      const searchInput = document.getElementById('qnaSearch');
      let activeCat = 'all';

      // Expose render for CMS category button re-binding
      window._qnaRender = function(cat) {
        if (cat !== undefined) activeCat = cat;
        renderQna();
      };

      function renderQna() {
        const posts = window.BoardData ? window.BoardData.getPosts() : [];
        const resolved = posts.filter(p => p.answer && p.answer.trim() !== '');
        const query = searchInput.value.toLowerCase().trim();

        const filtered = resolved.filter(p => {
          const catMatch = activeCat === 'all' || (p.category || '').toLowerCase() === activeCat.toLowerCase();
          const searchMatch = !query ||
            (p.question || '').toLowerCase().includes(query) ||
            (p.answer || '').toLowerCase().includes(query) ||
            (p.category || '').toLowerCase().includes(query);
          return catMatch && searchMatch;
        });

        if (filtered.length === 0) {
          accordion.innerHTML = '';
          emptyEl.classList.remove('hidden');
          return;
        }
        emptyEl.classList.add('hidden');

        accordion.innerHTML = filtered.map((p, i) => `
          <div class="accordion-item" data-index="${i}">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open'); const body=this.nextElementSibling; body.style.maxHeight = body.style.maxHeight ? null : body.scrollHeight+'px';">
              <span class="q-category">${esc(p.category)}</span>
              <span class="q-text">${esc(p.question)}</span>
              <span class="q-status ${p.resolved === 'Yes' ? 'resolved' : 'pending'}">${p.resolved === 'Yes' ? (window._lang === 'en' ? 'Resolved' : '해결') : (window._lang === 'en' ? 'Pending' : '대기')}</span>
              <svg class="accordion-arrow" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">
                <p>${esc(p.answer)}</p>
                <div class="answer-meta">
                  ${window._lang === 'en' ? 'Answered by' : '답변자'}: <strong>${esc(p.answeredBy || '-')}</strong>
                  &nbsp;|&nbsp;
                  ${window._lang === 'en' ? 'Date' : '날짜'}: ${p.date}
                  ${p.followUp ? `&nbsp;|&nbsp; F/U: ${esc(p.followUp)}` : ''}
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }

      function esc(t) { if(!t) return ''; const d=document.createElement('div'); d.textContent=t; return d.innerHTML; }

      searchInput.addEventListener('input', renderQna);
      BoardData.subscribe(() => renderQna());
    });
  </script>
</body>
</html>
